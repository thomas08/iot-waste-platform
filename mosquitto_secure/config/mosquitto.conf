# ===========================================
# Mosquitto MQTT Broker Configuration
# IoT Waste Management Platform - Secure Version
# ===========================================

# Persistence settings
persistence true
persistence_location /mosquitto/data/

# Logging
log_dest file /mosquitto/log/mosquitto.log
log_dest stdout
log_type error
log_type warning
log_type notice
log_type information
log_timestamp true
log_timestamp_format %Y-%m-%d %H:%M:%S

# Network listeners
listener 1883
protocol mqtt

# WebSocket support
listener 9001
protocol websockets

# ===========================================
# SECURITY SETTINGS
# ===========================================

# IMPORTANT: Disable anonymous access for production
allow_anonymous false

# Password authentication file
# Generated with: mosquitto_passwd -c passwd username
password_file /mosquitto/config/passwd

# Access Control List
acl_file /mosquitto/config/acl.conf

# ===========================================
# CONNECTION & MESSAGE LIMITS
# ===========================================

# Maximum simultaneous client connections (-1 = unlimited)
max_connections -1

# Maximum time in seconds between PING messages
max_keepalive 65535

# Maximum number of QoS 1 and 2 messages to hold in queue per client
max_queued_messages 1000

# Maximum publish payload size (0 = unlimited)
message_size_limit 268435456

# Persistence cleanup
persistent_client_expiration 1h

# ===========================================
# PERFORMANCE TUNING
# ===========================================

# Allow duplicate messages
allow_duplicate_messages false

# Autosave interval (seconds) - how often persistence db is written
autosave_interval 300

# ===========================================
# NOTE: Before starting the broker:
# 1. Run setup_mqtt_auth.sh to create password file
# 2. Verify acl.conf permissions are set correctly
# 3. Restart mosquitto service
# ===========================================
